@page "/"
@using _3ai.solutions.Saferpay.Models;
@inject _3ai.solutions.Saferpay.SaferpayService saferpayService;
@inject Microsoft.Extensions.Options.IOptions<SaferpayConfig> saferpayConfig;
<PageTitle>Index</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<iframe src="@url" width="500px" height="500px"></iframe>

@code
{
    string url;
    protected override void OnInitialized()
    {
        var response = saferpayService.PaymentPageInitialize(new PaymentPageInitializeRQ()
            {
                TerminalId = saferpayConfig.Value.TerminalId,
                Payment = new Payment()
                {
                    Amount = new Amount()
                    {
                        Value = "1000",
                        CurrencyCode = "CHF"
                    },
                    OrderId = Guid.NewGuid().ToString(),
                    Description = "Test"
                },
                ReturnUrl = new ReturnUrl()
                {
                    Url = "https://localhost:7279/PaymentRedirectEndpoint"
                }
            });
        url = response.RedirectUrl;
    }
}
