@page "/counter"
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@inject ProtectedSessionStorage ProtectedSessionStore
@using _3ai.solutions.Saferpay.Models;
@inject _3ai.solutions.Saferpay.SaferpayService saferpayService;

<PageTitle>Counter</PageTitle>

@token

<h1>Counter</h1>

<p role="status">Current count: @currentCount</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>

@code {
    private int currentCount = 0;
    string? token;
    protected override async void OnInitialized()
    {
        var result = await ProtectedSessionStore.GetAsync<string>("token");
        token = result.Success ? result.Value : "";

        if (!string.IsNullOrEmpty(token))
        {
            var rs = saferpayService.PaymentPageAssert(new() { Token = token });
            if (rs is not null && rs.Transaction.Status == TransactionStatus.AUTHORIZED)
            {
                var rss = saferpayService.TransactionCapture(new() { TransactionReference = new() { TransactionId = rs.Transaction.Id } });
                var st = rss.Status;
            }
            
        }
        //saferpayService.TransactionInquire(new() { TransactionReference = new() { TransactionId } })
    }

    private void IncrementCount()
    {
        currentCount++;
    }
}
